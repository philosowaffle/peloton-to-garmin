import{top,left,right,bottom,start}from"../enums.js";import getBasePlacement from"../utils/getBasePlacement.js";import getMainAxisFromPlacement from"../utils/getMainAxisFromPlacement.js";import getAltAxis from"../utils/getAltAxis.js";import{within,withinMaxClamp}from"../utils/within.js";import getLayoutRect from"../dom-utils/getLayoutRect.js";import getOffsetParent from"../dom-utils/getOffsetParent.js";import detectOverflow from"../utils/detectOverflow.js";import getVariation from"../utils/getVariation.js";import getFreshSideObject from"../utils/getFreshSideObject.js";import{min as mathMin,max as mathMax}from"../utils/math.js";function preventOverflow(t){var e,i,a=t.state,o=t.options,r=t.name,s=o.mainAxis,n=void 0===s||s,m=o.altAxis,l=void 0!==m&&m,f=o.boundary,p=o.rootBoundary,d=o.altBoundary,g=o.padding,c=o.tether,h=void 0===c||c,u=o.tetherOffset,x=void 0===u?0:u,w=detectOverflow(a,{boundary:f,rootBoundary:p,padding:g,altBoundary:d}),A=getBasePlacement(a.placement),y=getVariation(a.placement),O=!y,j=getMainAxisFromPlacement(A),v=getAltAxis(j),b=a.modifiersData.popperOffsets,M=a.rects.reference,t=a.rects.popper,s="function"==typeof x?x(Object.assign({},a.rects,{placement:a.placement})):x,m="number"==typeof s?{mainAxis:s,altAxis:s}:Object.assign({mainAxis:0,altAxis:0},s),c=a.modifiersData.offset?a.modifiersData.offset[a.placement]:null,o={x:0,y:0};b&&(n&&(u="y"===j?top:left,f="y"===j?bottom:right,p="y"===j?"height":"width",g=(i=b[j])+w[u],e=i-w[f],d=h?-t[p]/2:0,x=(y===start?M:t)[p],s=y===start?-t[p]:-M[p],n=a.elements.arrow,y=h&&n?getLayoutRect(n):{width:0,height:0},u=(n=a.modifiersData["arrow#persistent"]?a.modifiersData["arrow#persistent"].padding:getFreshSideObject())[u],f=n[f],y=within(0,M[p],y[p]),u=O?M[p]/2-d-y-u-m.mainAxis:x-y-u-m.mainAxis,y=O?-M[p]/2+d+y+f+m.mainAxis:s+y+f+m.mainAxis,f=(f=a.elements.arrow&&getOffsetParent(a.elements.arrow))?"y"===j?f.clientTop||0:f.clientLeft||0:0,f=i+u-(u=null!=(u=null==c?void 0:c[j])?u:0)-f,u=i+y-u,e=within(h?mathMin(g,f):g,i,h?mathMax(e,u):e),b[j]=e,o[j]=e-i),l&&(e="x"===j?top:left,i="x"===j?bottom:right,l="y"===v?"height":"width",e=(j=b[v])+w[e],w=j-w[i],i=-1!==[top,left].indexOf(A),c=null!=(A=null==c?void 0:c[v])?A:0,A=i?e:j-M[l]-t[l]-c+m.altAxis,m=i?j+M[l]+t[l]-c-m.altAxis:w,w=h&&i?withinMaxClamp(A,j,m):within(h?A:e,j,h?m:w),b[v]=w,o[v]=w-j),a.modifiersData[r]=o)}export default{name:"preventOverflow",enabled:!0,phase:"main",fn:preventOverflow,requiresIfExists:["offset"]};